stages:
- stage: Build
  jobs:
  - job: BuildJob
    pool:
        name: Hosted VS2017
        demands: msbuild

    steps:
    - script: echo Building!
    - bash: |
        echo '$(Build_BuildID)' $BUILD_BUILDID
        BUILDNUMBER=$BUILD_BUILDID
        VERSION=1.0.$BUILDNUMBER
        echo 'VERSION ' $VERSION
        
        #if ! [ $BRANCH = master ]; then
        #   VERSION=1.0.$BUILDNUMBER
        #    echo "##vso[build.updatebuildnumber]$VERSION"
        #fi;
        
        echo "##vso[task.setvariable variable=Version]$VERSION"
        displayName: 'Set Version'

        - task: NuGetToolInstaller@0
        displayName: 'Use NuGet 4.3.1'
        inputs:
            versionSpec: 4.3.1

        - task: NuGetCommand@2
        displayName: 'NuGet restore : MobCAT'
        inputs:
            restoreSolution: 'mobcat_shared/MobCAT/MobCAT.csproj'

        - task: NuGetCommand@2
        displayName: 'NuGet restore : MobCAT.Forms'
        inputs:
            restoreSolution: 'mobcat_shared/MobCAT.Forms/MobCAT.Forms.csproj'

        # - task: NuGetCommand@2
        # displayName: 'NuGet restore : MobCAT.Droid'
        # inputs:
        #     restoreSolution: 'mobcat_shared/MobCAT.Droid/MobCAT.Droid.csproj'

        # - task: NuGetCommand@2
        # displayName: 'NuGet restore : MobCAT.iOS'
        # inputs:
        #     restoreSolution: 'mobcat_shared/MobCAT.iOS/MobCAT.iOS.csproj'

        - task: MSBuild@1
        displayName: 'Build MobCAT'
        inputs:
            solution: 'mobcat_shared/MobCAT/MobCAT.csproj'
            configuration: '$(BuildConfiguration)'

        - task: MSBuild@1
        displayName: 'Build MobCAT.Forms'
        inputs:
            solution: 'mobcat_shared/MobCAT.Forms/MobCAT.Forms.csproj'
            configuration: '$(BuildConfiguration)'

        # - task: MSBuild@1
        # displayName: 'Build MobCAT.Droid'
        # inputs:
        #     solution: 'mobcat_shared/MobCAT.Droid/MobCAT.Droid.csproj'
        #     configuration: '$(BuildConfiguration)'

        # - task: MSBuild@1
        # displayName: 'Build MobCAT.iOS'
        # inputs:
        #     solution: 'mobcat_shared/MobCAT.iOS/MobCAT.iOS.csproj'
        #     configuration: '$(BuildConfiguration)'


- stage: Deploy
  jobs:
  - job: Deploy
    pool:
        name: Hosted VS2017
        demans: msbuild

    steps:
    - script: echo Deploying the code!
